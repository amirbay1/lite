<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>هاب اتصال امن | V2Ray Aggregator</title>
    <meta name="description" content="مجموعه کانفیگ‌های رایگان V2Ray و ابزارهای اتصال امن">
    
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>
    <!-- Vazirmatn Font (Beautiful Persian Font) -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-sec: #6b7280;
            --border: #e5e7eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 16px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #111827;
                --card-bg: #1f2937;
                --text-main: #f9fafb;
                --text-sec: #d1d5db;
                --border: #374151;
            }
        }

        * { box-sizing: border-box; outline: none; }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Layout */
        .container {
            width: 100%;
            max-width: 1200px;
            padding: 20px;
            margin: 0 auto;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--primary), #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        /* Controls & Filters */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 200px;
        }

        select, input {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg-color);
            color: var(--text-main);
            font-family: inherit;
            font-size: 14px;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-family: inherit;
            transition: transform 0.2s, opacity 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: white;
            font-size: 14px;
        }

        button:active { transform: scale(0.96); }
        
        .btn-primary { background-color: var(--primary); }
        .btn-primary:hover { background-color: var(--primary-hover); }
        
        .btn-purple { background-color: #8b5cf6; }
        .btn-purple:hover { background-color: #7c3aed; }
        
        .btn-green { background-color: var(--success); }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: space-between;
            color: var(--text-sec);
            font-size: 0.9rem;
            margin-bottom: 20px;
            padding: 0 10px;
        }

        /* Grid Layout */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            width: 100%;
        }

        /* Proxy Card */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            position: relative;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .badge-protocol { background: #e0f2fe; color: #0369a1; }
        .badge-source { background: #f3f4f6; color: #4b5563; font-weight: 500; display: flex; align-items: center; gap: 4px; margin-top: 8px; width: fit-content; font-size: 0.7rem; }
        .badge-national { background: #fef3c7; color: #b45309; }

        .card-title {
            margin: 0;
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            direction: ltr; /* Force LTR for domains/IPs */
            text-align: right;
        }

        .card-meta {
            font-size: 0.85rem;
            color: var(--text-sec);
            margin-bottom: 15px;
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-actions {
            margin-top: auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .card-btn {
            background: var(--bg-color);
            color: var(--text-main);
            padding: 8px;
            font-size: 0.85rem;
            border: 1px solid var(--border);
        }
        .card-btn:hover { background: #e5e7eb; }
        
        .btn-full { grid-column: 1 / -1; }

        /* Loading & Progress */
        .loading-container {
            width: 100%;
            text-align: center;
            padding: 40px;
            display: none;
        }
        .loading-container.active { display: block; }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        .progress-bar-wrap {
            width: 100%;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            z-index: 1000;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
            pointer-events: none;
        }
        .toast.show { transform: translateX(-50%) translateY(0); }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
        }
        .modal-overlay.open { opacity: 1; visibility: visible; }
        
        .modal-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: var(--radius);
            max-width: 90%;
            width: 350px;
            text-align: center;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        footer {
            margin-top: 50px;
            padding: 20px;
            color: var(--text-sec);
            text-align: center;
            font-size: 0.85rem;
            border-top: 1px solid var(--border);
            width: 100%;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1><i class="fas fa-shield-halved"></i> هاب اتصال امن</h1>
            <p style="color: var(--text-sec);">مجموعه‌ای از بهترین کانفیگ‌های V2Ray برای دسترسی آزاد</p>
        </header>

        <!-- Controls -->
        <div class="controls" id="filterSection" style="display: none;">
            <div class="input-group">
                <i class="fas fa-filter" style="color: var(--text-sec);"></i>
                <select id="sourceFilter">
                    <option value="all">همه مخازن</option>
                </select>
            </div>
            
            <div class="input-group">
                <i class="fas fa-search" style="color: var(--text-sec);"></i>
                <input type="text" id="searchInput" placeholder="جستجو (نام، پروتکل...)">
            </div>

            <button id="updateButton" class="btn-primary">
                <i class="fas fa-sync-alt"></i> بروزرسانی
            </button>
            <button id="copyAllButton" class="btn-purple">
                <i class="fas fa-copy"></i> کپی همه
            </button>
            <button id="copyRandomButton" class="btn-green">
                <i class="fas fa-random"></i> 20 تایی رندوم
            </button>
        </div>

        <div class="stats-bar">
            <span id="proxyCount">0 کانفیگ</span>
            <span id="lastUpdatedDate">بروزرسانی: --</span>
        </div>

        <!-- Loading -->
        <div id="loadingSection" class="loading-container">
            <div class="spinner"></div>
            <div id="loadingText" style="margin-bottom: 5px;">در حال دریافت اطلاعات...</div>
            <div class="progress-bar-wrap">
                <div id="progressBar" class="progress-bar"></div>
            </div>
            <small id="elapsedTime" style="display: block; margin-top: 5px; color: var(--text-sec);">00:00</small>
        </div>

        <!-- Content -->
        <div id="proxiesGrid" class="grid"></div>
        <div id="loadMoreTrigger" style="height: 50px; margin-top: 20px;"></div>

        <footer>
            طراحی شده با ❤️ برای آزادی اینترنت
        </footer>
    </div>

    <!-- Modals -->
    <div id="qrModal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="margin-top: 0; color: var(--primary);">QR Code</h3>
            <canvas id="qrCanvas"></canvas>
            <button class="btn-primary" style="width: 100%; margin-top: 20px;" onclick="closeModal()">بستن</button>
        </div>
    </div>

    <div id="toast" class="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">پیام سیستم</span>
    </div>

    <script>
        // --- Configuration ---
        const CONFIG = {
            cacheKey: 'v2ray_hub_cache',
            cacheExpiration: 12 * 60 * 60 * 1000, // 12 hours
            proxiesPerLoad: 24,
            iranConfigUrl: "https://raw.githubusercontent.com/SoliSpirit/v2ray-configs/main/Countries/Iran.txt"
        };

        const SOURCES = {
            direct: [
                { url: "https://raw.githubusercontent.com/MahsaNetConfigTopic/config/refs/heads/main/xray_final.txt", name: "MahsaNet" },
                { url: "https://raw.githubusercontent.com/sinabigo/Xray/main/@sinavm", name: "Sinabigo" },
                { url: "https://raw.githubusercontent.com/Ashkan-m/v2ray/main/Sub.txt", name: "Ashkan-m" },
                { url: "https://raw.githubusercontent.com/mahdibland/V2RayAggregator/master/Eternity.txt", name: "MahdiBland" },
                { url: "https://raw.githubusercontent.com/hamedp-71/openproxylist/refs/heads/main/V2RAY.txt", name: "HamedP (V2Ray)" },
                { url: "https://raw.githubusercontent.com/hamedp-71/Trojan/refs/heads/main/hp.txt", name: "HamedP (Trojan)" },
                { url: CONFIG.iranConfigUrl, name: "Iran National" }
            ],
            base64: [
                { url: "https://raw.githubusercontent.com/imyebekhe/vpn-fail/refs/heads/main/sub-link", name: "imyebekhe" },
                { url: "https://raw.githubusercontent.com/mahdibland/ShadowsocksAggregator/master/Eternity", name: "MahdiBland SS" },
                { url: "https://raw.githubusercontent.com/AzadNetCH/Clash/main/AzadNet.txt", name: "AzadNet" },
                { url: "https://raw.githubusercontent.com/mahsanet/MahsaFreeConfig/main/app/sub.txt", name: "MahsaNet App" },
                { url: "https://raw.githubusercontent.com/davudsedft/purvpn/refs/heads/main/links/pc.txt", name: "PurVPN PC" },
                { url: "https://raw.githubusercontent.com/davudsedft/purvpn/refs/heads/main/links/purkow.txt", name: "PurVPN" }
            ]
        };

        // Add MahsaFreeConfig MTN/MCI
        for (let i = 1; i <= 3; i++) {
            SOURCES.base64.push({ url: `https://raw.githubusercontent.com/mahsanet/MahsaFreeConfig/main/mtn/sub_${i}.txt`, name: `MahsaNet MTN ${i}` });
            SOURCES.base64.push({ url: `https://raw.githubusercontent.com/mahsanet/MahsaFreeConfig/main/mci/sub_${i}.txt`, name: `MahsaNet MCI ${i}` });
        }

        // --- State Management ---
        let state = {
            allConfigs: [],
            filteredConfigs: [],
            currentIndex: 0,
            isLoading: false
        };

        // --- DOM Elements ---
        const els = {
            grid: document.getElementById('proxiesGrid'),
            filterSection: document.getElementById('filterSection'),
            loading: document.getElementById('loadingSection'),
            progressBar: document.getElementById('progressBar'),
            loadingText: document.getElementById('loadingText'),
            elapsedTime: document.getElementById('elapsedTime'),
            sourceSelect: document.getElementById('sourceFilter'),
            searchInput: document.getElementById('searchInput'),
            count: document.getElementById('proxyCount'),
            date: document.getElementById('lastUpdatedDate'),
            toast: document.getElementById('toast'),
            qrModal: document.getElementById('qrModal'),
            loadMore: document.getElementById('loadMoreTrigger')
        };

        // --- Core Functions ---

        async function init() {
            // Check cache
            const cached = loadFromCache();
            if (cached) {
                state.allConfigs = cached;
                finalizeDataLoad();
            } else {
                await fetchAllData();
            }

            setupEventListeners();
        }

        function convertGithubUrl(url) {
            return url.replace("github.com", "raw.githubusercontent.com").replace("/blob/", "/");
        }

        async function fetchAllData() {
            els.loading.classList.add('active');
            els.filterSection.style.display = 'none';
            els.grid.innerHTML = '';
            
            const allUrls = [
                ...SOURCES.direct.map(s => ({ ...s, decode: false })),
                ...SOURCES.base64.map(s => ({ ...s, decode: true }))
            ];
            
            const uniqueConfigs = new Map();
            let completed = 0;
            const startTime = Date.now();
            
            // Timer
            const timer = setInterval(() => {
                const seconds = Math.floor((Date.now() - startTime) / 1000);
                const mins = String(Math.floor(seconds / 60)).padStart(2, '0');
                const secs = String(seconds % 60).padStart(2, '0');
                els.elapsedTime.textContent = `${mins}:${secs}`;
            }, 1000);

            // Fetch in parallel but with limits isn't needed for this scale, mostly
            const promises = allUrls.map(async (source) => {
                try {
                    const cleanUrl = convertGithubUrl(source.url);
                    const res = await fetch(cleanUrl);
                    if (!res.ok) throw new Error(res.status);
                    let text = await res.text();
                    
                    if (source.decode) {
                        try { text = atob(text.trim()); } catch(e) {}
                    }

                    const lines = text.split(/\r?\n/);
                    lines.forEach(line => {
                        line = line.trim();
                        if (!line) return;

                        // Try deeper decoding if needed
                        if (!line.includes('://')) {
                            try { line = atob(line); } catch(e) {}
                        }

                        // Basic Validation
                        if (line.match(/^(vmess|vless|trojan|ss|ssr|warp):\/\//i)) {
                            // Check for "Iran" source
                            const isNational = source.url === CONFIG.iranConfigUrl;
                            // Use config as key to remove duplicates
                            if (!uniqueConfigs.has(line)) {
                                uniqueConfigs.set(line, {
                                    config: line,
                                    source: source.name,
                                    protocol: line.split(':')[0],
                                    isNational: isNational
                                });
                            }
                        }
                    });

                } catch (e) {
                    console.warn(`Failed ${source.name}:`, e);
                } finally {
                    completed++;
                    const pct = Math.round((completed / allUrls.length) * 100);
                    els.progressBar.style.width = `${pct}%`;
                    els.loadingText.textContent = `در حال دریافت... (${completed}/${allUrls.length})`;
                }
            });

            await Promise.all(promises);
            clearInterval(timer);
            
            state.allConfigs = Array.from(uniqueConfigs.values());
            saveToCache(state.allConfigs);
            finalizeDataLoad();
        }

        function finalizeDataLoad() {
            els.loading.classList.remove('active');
            els.filterSection.style.display = 'flex';
            
            updateFiltersUI();
            updateLastUpdateText();
            applyFilters();
        }

        // --- Parsing & Display Logic ---

        function parseConfig(configStr) {
            let title = "کانفیگ بی نام";
            let type = configStr.split(':')[0].toUpperCase();
            
            try {
                if (type === 'VMESS' || type === 'VLESS') {
                    const b64 = configStr.split('://')[1];
                    // Try LZString then normal Base64
                    let jsonStr;
                    try { jsonStr = atob(b64); } catch { return { title, type }; }
                    
                    // Decode URI components for Persian names
                    try { jsonStr = decodeURIComponent(escape(jsonStr)); } catch {}

                    const obj = JSON.parse(jsonStr);
                    title = obj.ps || obj.add || title;
                } else {
                    // Simple parse for Trojan/SS
                    const url = new URL(configStr);
                    title = url.hash ? decodeURIComponent(url.hash.substring(1)) : url.hostname;
                }
            } catch (e) {
                // Fallback: Just show first few chars
                title = configStr.substring(0, 20) + '...';
            }
            return { title, type };
        }

        function createCard(item) {
            const { title, type } = parseConfig(item.config);
            
            const card = document.createElement('div');
            card.className = 'card';
            
            const isNationalHtml = item.isNational ? 
                `<span class="badge badge-national"><i class="fas fa-flag"></i> ایران</span>` : '';

            card.innerHTML = `
                <div class="card-header">
                    <span class="badge badge-protocol">${type}</span>
                    ${isNationalHtml}
                </div>
                <h3 class="card-title">${title}</h3>
                <div class="badge-source"><i class="fas fa-server"></i> ${item.source}</div>
                <div class="card-meta" style="margin-top:10px;">
                    ${item.config.substring(0, 40)}...
                </div>
                <div class="card-actions">
                    <button class="card-btn" onclick="copyToClipboard('${item.config}')">
                        <i class="fas fa-copy"></i> کپی
                    </button>
                    <button class="card-btn" onclick="showQR('${item.config}')">
                        <i class="fas fa-qrcode"></i> QR
                    </button>
                    <button class="card-btn btn-full" onclick="deepLink('${item.config}')" style="background:var(--primary); color:white; border:none;">
                        <i class="fas fa-bolt"></i> اتصال مستقیم
                    </button>
                </div>
            `;
            return card;
        }

        // --- Infinite Scroll & Rendering ---

        function applyFilters() {
            const source = els.sourceSelect.value;
            const search = els.searchInput.value.toLowerCase();

            state.filteredConfigs = state.allConfigs.filter(item => {
                const matchSource = source === 'all' || item.source === source;
                const matchSearch = !search || item.config.toLowerCase().includes(search) || 
                                    (item.source && item.source.toLowerCase().includes(search));
                return matchSource && matchSearch;
            });

            els.count.textContent = `${state.filteredConfigs.length} کانفیگ موجود`;
            els.grid.innerHTML = '';
            state.currentIndex = 0;
            loadMore();
        }

        function loadMore() {
            if (state.isLoading) return;
            state.isLoading = true;

            const next = state.filteredConfigs.slice(state.currentIndex, state.currentIndex + CONFIG.proxiesPerLoad);
            if (next.length === 0) {
                state.isLoading = false;
                return;
            }

            const fragment = document.createDocumentFragment();
            next.forEach(item => fragment.appendChild(createCard(item)));
            els.grid.appendChild(fragment);

            state.currentIndex += CONFIG.proxiesPerLoad;
            state.isLoading = false;
        }

        // --- Helpers ---

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('کپی شد!', 'success');
            }).catch(() => {
                // Fallback
                const ta = document.createElement('textarea');
                ta.value = text;
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);
                showToast('کپی شد!', 'success');
            });
        }

        function deepLink(config) {
            // Attempt to open in v2rayNG or similar apps
            window.location.href = config;
            // Also copy just in case
            copyToClipboard(config);
            showToast('کپی شد و در حال باز شدن...', 'info');
        }

        function showQR(text) {
            const canvas = document.getElementById('qrCanvas');
            QRCode.toCanvas(canvas, text, { width: 250, margin: 2 }, function (error) {
                if (error) console.error(error);
                els.qrModal.classList.add('open');
            });
        }

        function closeModal() {
            els.qrModal.classList.remove('open');
        }

        function showToast(msg, type = 'info') {
            document.getElementById('toastMessage').textContent = msg;
            els.toast.classList.add('show');
            setTimeout(() => els.toast.classList.remove('show'), 3000);
        }

        function saveToCache(data) {
            try {
                const payload = JSON.stringify({ data, time: Date.now() });
                const compressed = LZString.compressToUTF16(payload);
                localStorage.setItem(CONFIG.cacheKey, compressed);
            } catch (e) { console.warn('Cache failed', e); }
        }

        function loadFromCache() {
            try {
                const compressed = localStorage.getItem(CONFIG.cacheKey);
                if (!compressed) return null;
                const json = LZString.decompressFromUTF16(compressed);
                const { data, time } = JSON.parse(json);
                if (Date.now() - time > CONFIG.cacheExpiration) return null;
                return data;
            } catch (e) { return null; }
        }

        function updateLastUpdateText() {
            try {
                const compressed = localStorage.getItem(CONFIG.cacheKey);
                if(compressed) {
                    const { time } = JSON.parse(LZString.decompressFromUTF16(compressed));
                    const d = new Date(time);
                    els.date.textContent = `بروزرسانی: ${d.getHours()}:${String(d.getMinutes()).padStart(2,0)}`;
                }
            } catch {}
        }

        function updateFiltersUI() {
            const sources = [...new Set(state.allConfigs.map(c => c.source))].sort();
            els.sourceSelect.innerHTML = '<option value="all">همه مخازن</option>';
            sources.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s;
                opt.textContent = s;
                els.sourceSelect.appendChild(opt);
            });
        }

        // --- Event Listeners ---

        function setupEventListeners() {
            // Scroll Observer for Infinite Scroll
            const observer = new IntersectionObserver((entries) => {
                if(entries[0].isIntersecting) loadMore();
            }, { threshold: 0.1 });
            observer.observe(els.loadMore);

            // Controls
            document.getElementById('updateButton').onclick = () => fetchAllData();
            
            document.getElementById('copyAllButton').onclick = () => {
                if (!state.filteredConfigs.length) return showToast('لیست خالی است', 'error');
                const text = state.filteredConfigs.map(c => c.config).join('\n');
                copyToClipboard(text);
                showToast(`کپی تمام ${state.filteredConfigs.length} کانفیگ`, 'success');
            };

            document.getElementById('copyRandomButton').onclick = () => {
                if (!state.filteredConfigs.length) return;
                const shuffled = [...state.filteredConfigs].sort(() => 0.5 - Math.random());
                const selected = shuffled.slice(0, 20).map(c => c.config).join('\n');
                copyToClipboard(selected);
                showToast('20 کانفیگ رندوم کپی شد', 'success');
            };

            els.sourceSelect.onchange = applyFilters;
            els.searchInput.oninput = applyFilters; // Real-time search
            
            els.qrModal.onclick = (e) => {
                if(e.target === els.qrModal) closeModal();
            };
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>
